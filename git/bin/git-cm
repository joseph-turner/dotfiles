#!/usr/local/bin/zsh

autoload colors; colors

usage() {}

local push

while getopts ":p:" opt; do
  case $opt in
    p)
      push=1
      ;;
    \?)
      echo "Invalid option: -$OPTARG"
      return 1
      ;;
    :)
      echo "Option -$OPTARG requires an argument"
      return 1
      ;;
  esac
done
shift "$((OPTIND-1))"

message=`echo $@ | cut -d ' ' -f2-`

if git add -A && git commit -m "$message"; then
  echo "$fg[green]\nCommit successful!$reset_color"
else
  echo "$fg[red]Commit failed$reset_color"
  push=0
fi

[[ $push == 1 ]] && git pu || echo
